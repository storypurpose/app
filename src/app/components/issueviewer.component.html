<div class="main-container">
    <div class="body-container">
        <as-split direction="horizontal">
            <as-split-area size="30" class="split-area bg-light border-right">
                <div *ngIf="treeNodes">
                    <p-contextMenu #cm [model]="menulist" appendTo="body"></p-contextMenu>
                    <p-tree [value]="treeNodes" selectionMode="single" (onNodeExpand)="loadNode($event)"
                        [(selection)]="selectedNode" (onNodeSelect)="nodeSelected($event)" [contextMenu]="cm"
                        (onNodeContextMenuSelect)="nodeContextMenuSelect($event.node, cm)">
                        <ng-template let-node pTemplate="Epic">
                            <app-node-template [node]="node" icon="book" badge="badge-primary"></app-node-template>
                        </ng-template>
                        <ng-template let-node pTemplate="Organization">
                            <h3 class="m-0 font-weight-light">{{node.label}}</h3>
                        </ng-template>
                        <ng-template let-node pTemplate="Project">
                            <h4 class="m-0 font-weight-light">{{node.label}}</h4>
                        </ng-template>
                        <ng-template let-node pTemplate="Initiative">
                            <h5 class="m-0 font-weight-light">{{node.label}}</h5>
                        </ng-template>
                        <ng-template let-node pTemplate="Story">
                            <app-node-template [node]="node" icon="file-alt" badge="badge-info"></app-node-template>
                        </ng-template>
                        <ng-template let-node pTemplate="Test Suite">
                            <app-node-template [node]="node" icon="flask" badge="badge-warning"></app-node-template>
                        </ng-template>
                        <ng-template let-node pTemplate="ST-Test Case">
                            <app-node-template [node]="node" [icon]="['far','bookmark']" badge="badge-success">
                            </app-node-template>
                        </ng-template>
                        <ng-template let-node pTemplate="Task">
                            <app-node-template [node]="node" icon="check" badge="badge-success"></app-node-template>
                        </ng-template>
                    </p-tree>
                </div>
            </as-split-area>
            <as-split-area size="70" class="split-area">
                <div class="sticky-title pl-2 pb-2 pr-2" *ngIf="selectedIssue">
                    <div class="badge badge-light">{{selectedIssue.key}}</div>
                    <h3 class="font-weight-light">
                        {{selectedIssue.label}}
                    </h3>

                    <div class="btn-group float-right">
                        <button (click)="configureFields(selectedIssue.type)" class="btn btn-link text-muted"
                            title="Configure custom fields">
                            <fa-icon [icon]="['far','sun']"></fa-icon>
                        </button>
                        <a *ngIf="connectionDetails" class="btn btn-link text-muted" target="_blank"
                            href="{{connectionDetails.serverUrl}}/browse/{{selectedIssue.key}}"
                            title="Navigate to jira">
                            <fa-icon [icon]="['fab','jira']"></fa-icon>
                        </a>
                    </div>

                    <a class="btn btn-sm btn-light" [routerLink]="['purpose']" title="View purpose"
                        [routerLinkActive]="'active'" (click)="expandPurpose(loadedIssue)">
                        <fa-icon icon="binoculars"></fa-icon> Purpose
                    </a>
                    <a class="btn btn-sm btn-light mr-1" *ngIf="hasExtendedFields" routerLink="details"
                        [routerLinkActive]="'active'">
                        <fa-icon icon="tasks"></fa-icon> Details
                    </a>
                    <a class="btn btn-sm btn-light mr-1" *ngIf="canTrackProgress(selectedIssue)" routerLink="items"
                        [routerLinkActive]="'active'">
                        <fa-icon icon="tasks"></fa-icon> Items
                    </a>
                </div>
                <div class="p-3">
                    <router-outlet></router-outlet>
                </div>
            </as-split-area>
        </as-split>
    </div>
</div>
<p-sidebar [(visible)]="showDetails" styleClass="ui-sidebar-lg" position="right">
    <app-sub-items [issue]="selectedIssue"></app-sub-items>
</p-sidebar>